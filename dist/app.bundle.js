(()=>{"use strict";const t=()=>{const t=()=>{const t=document.querySelector(".player-one.board"),e=document.querySelector(".player-two.board");for(let a=0;a<10;a++)for(let r=0;r<10;r++){const s=document.createElement("div");s.classList.add("cell"),s.dataset.row=a,s.dataset.col=r,t.append(s);const o=document.createElement("div");o.classList.add("cell"),o.dataset.row=a,o.dataset.col=r,e.append(o)}},e=()=>{const t=[];return[{name:"carrier",length:5},{name:"battleship",length:4},{name:"destroyer",length:3},{name:"submarine",length:2},{name:"patrol",length:2}].forEach((e=>{const a=document.createElement("div");a.classList.add("ship"),a.setAttribute("id",e.name),a.draggable="true",a.dataset.length=e.length,a.dataset.direction="row";for(let t=0;t<e.length;t++){const t=document.createElement("div");t.classList.add("ship-part"),a.append(t)}t.push(a)})),t},a=(t,e)=>{const[a,r]=e,s=parseInt(t.dataset.length),o=t.dataset.direction,n=[];if("row"===o)for(let t=r;t<r+s;t++)n.push([a,t]);else if("col"===o)for(let t=a;t<a+s;t++)n.push([t,r]);return n},r=(t,e)=>{if(!((t,e)=>{const a=parseInt(t.dataset.length),r=t.dataset.direction,[s,o]=e;if("row"===r){if(o+a-1<0||o+a-1>9)return!1}else if("col"===r&&(s+a-1<0||s+a-1>9))return!1;return!0})(t,e))return!1;const r=a(t,e),s=(()=>{const t=document.querySelectorAll(".active .cell .ship:not(.dragged)"),e=[];return t.forEach((t=>{const r=[parseInt(t.dataset.row),parseInt(t.dataset.col)];a(t,r).forEach((t=>e.push(t)))})),e})();return!s.length||!((t,e)=>{for(let a of t)for(let t of e){const e=Math.abs(a[0]-t[0]),r=Math.abs(a[1]-t[1]);if(e<=1&&r<=1)return!0}return!1})(r,s)},s=t=>{t.dataTransfer.setData("text/plain",t.target.id),t.target.classList.add("dragged")},o=t=>{t.preventDefault(),t.target.classList.toggle("dragged")},n=t=>{t.preventDefault()},c=t=>{const e=t.target.closest(".ship");if(!e.parentNode.classList.contains("cell"))return;const a=[parseInt(e.dataset.row),parseInt(e.dataset.col)],s=e.dataset.direction;e.classList.toggle("dragged"),"row"===s?(e.dataset.direction="col",r(e,a)?e.style.gridAutoFlow="row":e.dataset.direction="row"):"col"===s&&(e.dataset.direction="row",r(e,a)?e.style.gridAutoFlow="column":e.dataset.direction="col"),e.classList.toggle("dragged")},i=t=>{t.preventDefault(),t.target.classList.add("drag-over")},l=t=>{t.preventDefault(),t.target.classList.remove("drag-over")},d=t=>{t.preventDefault();const e=t.target,[a,s]=[parseInt(e.dataset.row),parseInt(e.dataset.col)];e.classList.remove("drag-over");const o=t.dataTransfer.getData("text/plain"),n=document.getElementById(o);try{if(!r(n,[a,s])||e.classList.contains("ship-part"))return;n.style.position="absolute",n.dataset.row=a,n.dataset.col=s,e.append(n)}catch{return}},u=()=>{document.querySelectorAll(".active .ship").forEach((t=>{t.addEventListener("dragstart",s),t.addEventListener("dragend",o),t.addEventListener("click",c)}))},h=()=>{const t=document.querySelector(".active .ship-container");e().forEach((e=>{t.append(e)})),u(),document.querySelectorAll(".active .board .cell").forEach((t=>{t.addEventListener("dragenter",i),t.addEventListener("dragleave",l),t.addEventListener("dragover",n),t.addEventListener("drop",d)}))},g=()=>{const t=document.querySelector(".active .ship-container");document.querySelectorAll(".active .ship").forEach((t=>t.remove())),e().forEach((e=>t.append(e))),u()},m=()=>[Math.floor(10*Math.random()),Math.floor(10*Math.random())],p=()=>{g(),document.querySelectorAll(".active .ship-container .ship").forEach((t=>{(t=>{"col"==(0===Math.floor(2*Math.random())?"row":"col")&&(t.style.gridAutoFlow="row",t.dataset.direction="col")})(t);let[e,a]=m();for(;!r(t,[e,a]);)[e,a]=m();t.style.position="absolute",t.dataset.row=e,t.dataset.col=a,document.querySelector(`.active .cell[data-row="${e}"][data-col="${a}"]`).append(t)}))},y=()=>{const t=document.querySelector(".game-mode-container"),e=document.querySelector(".game-container"),a=document.querySelector(".player-one-container"),r=document.querySelector(".controller-container");t.classList.toggle("inactive"),e.classList.toggle("inactive"),a.classList.toggle("inactive"),a.classList.toggle("active"),r.classList.toggle("inactive")},v=(t,e)=>{const a=document.querySelector(".player-one.display-name"),r=document.querySelector(".player-two.display-name");a.textContent=`${t.name} board`,r.textContent=`${e.name} board`};return{initVsPlayer:(e,a)=>{y(),document.querySelector("button.start-game").classList.toggle("inactive"),v(e,a),t(),h()},initVsComputer:(e,a)=>{y(),document.querySelector("button.next-player").classList.toggle("inactive"),v(e,a),t(),h()},resetBoard:g,placeRandomly:p,changePlayer:()=>{const t=document.querySelector(".player.active"),e=document.querySelector(".player.inactive");t.classList.toggle("active"),t.classList.toggle("inactive"),e.classList.toggle("active"),e.classList.toggle("inactive")},checkShipsPlaced:()=>document.querySelectorAll(".active .cell .ship").length>=5,getShipCoordinates:a,nextPlayerPlacement:()=>{(()=>{const t=document.querySelector(".player-one-container"),e=document.querySelector(".player-two-container"),a=document.querySelector("button.next-player"),r=document.querySelector("button.start-game");t.classList.toggle("active"),t.classList.toggle("inactive"),e.classList.toggle("active"),e.classList.toggle("inactive"),a.classList.toggle("inactive"),r.classList.toggle("inactive")})(),h()},displayWinner:t=>{document.querySelector(".winner-container").classList.toggle("inactive"),document.querySelector(".winner-message").textContent=`${t} wins!`},resetGame:()=>{const t=document.querySelector(".game-mode-container"),e=document.querySelector(".game-container"),a=document.querySelectorAll(".ship-container"),r=document.querySelectorAll(".player"),s=document.querySelector("button.next-player"),o=document.querySelector(".winner-container"),n=document.querySelector(".game-log");t.classList.toggle("inactive"),e.classList.toggle("inactive"),a.forEach((t=>t.classList.toggle("inactive"))),r.forEach((t=>t.classList.toggle("inactive"))),s.classList.toggle("inactive"),o.classList.toggle("inactive"),n.textContent="",document.querySelectorAll(".cell").forEach((t=>t.remove()))},displayBothBoards:()=>{document.querySelector(".player-one-container");const t=document.querySelector(".player-two-container"),e=document.querySelectorAll(".ship-container");t.classList.toggle("inactive"),e.forEach((t=>t.classList.toggle("inactive")))},placeComputerShips:()=>{const t=document.querySelector(".player-one-container"),e=document.querySelector(".player-two-container");t.classList.toggle("active"),e.classList.toggle("active"),p()},vsPlayerDisplayBothBoards:()=>{const t=document.querySelector(".player.active"),e=document.querySelector(".player.inactive");t.classList.toggle("active"),e.classList.toggle("inactive")},displayGameLog:t=>{document.querySelector(".game-log").textContent=`${t.name} turn`}}};class e{constructor(t,e){this.name=t,this.length=e,this.totalHits=0,this.sunk=!1}getHit(){this.totalHits+=1,this.isSunk()}isSunk(){this.sunk=this.totalHits>=this.length}}class a{constructor(){this.board=Array.from({length:10},(()=>Array.from({length:10}).fill(null))),this.ships={}}addShip(t,a,r){const s=new e(t,a);this.ships[t]=s,r.forEach((t=>{const[e,a]=t;this.board[e][a]=s}))}receiveAttack(t){const[e,a]=t;return!!this.board[e][a]&&(this.board[e][a].getHit(),!0)}getShips(){return Object.values(this.ships)}allShipsSunk(){return this.getShips().every((t=>t.sunk))}resetBoard(){this.board=Array.from({length:10},(()=>Array.from({length:10}).fill(null))),this.ships={}}}class r{constructor(t){this.name=t,this.board=new a,this.enemyBoard=null,this.turn=!1}setEnemyBoard(t){this.enemyBoard=t}getBoard(){return this.board}addShip(t,e,a){this.board.addShip(t,e,a)}playerAttack(t){return this.enemyBoard.receiveAttack(t)}checkGameOver(){return this.enemyBoard.allShipsSunk()}reset(){this.board.resetBoard()}}class s extends r{constructor(t){super(t),this.allAttacksDone=[],this.attackHit=!1,this.allHitAttacks=[],this.nextAttack=[]}isAttackAlreadyDone(t){const[e,a]=t;for(let t of this.allAttacksDone)if(t[0]===e&&t[1]===a)return!0;return!1}randomCoordinates(){let t=Math.floor(10*Math.random()),e=Math.floor(10*Math.random());for(;this.isAttackAlreadyDone([t,e]);)t=Math.floor(10*Math.random()),e=Math.floor(10*Math.random());return[t,e]}computerAttacks(){if(this.attackHit&&this.nextAttack.length){if(this.attackHit&&this.nextAttack.length){const t=this.nextAttack.shift();this.allAttacksDone.push(t);const e=this.enemyBoard.receiveAttack(t);if(e)return this.computerHits();if(!e&&!this.nextAttack.length)return this.resetAttackStatus(),!1}}else{this.resetAttackStatus();const t=this.randomComputerAttack();if(t)return this.computerHits();if(!t)return!1}}randomComputerAttack(){const t=this.randomCoordinates();return this.allAttacksDone.push(t),this.enemyBoard.receiveAttack(t)}computerHits(){this.attackHit=!0,this.allHitAttacks.push(this.allAttacksDone.at(-1));const t=this.allHitAttacks.at(-1);if([[1,0],[-1,0],[0,1],[0,-1]].forEach((e=>{const a=e[0]+t[0],r=e[1]+t[1];this.isAttackAlreadyDone([a,r])||a<0||r<0||a>9||r>9||this.nextAttack.push([a,r])})),this.allHitAttacks.length>1){const e=this.allHitAttacks.at(-2);t[0]===e[0]?this.nextAttack=this.nextAttack.filter((e=>e[0]===t[0])):t[1]===e[1]&&(this.nextAttack=this.nextAttack.filter((e=>e[1]===t[1])))}return!0}resetAttackStatus(){this.attackHit=!1,this.allHitAttacks=[],this.nextAttack=[]}getLastCoordinates(){return this.allAttacksDone.at(-1)}}const o=()=>{const t=document.querySelector(".change-player-container"),e=document.querySelector(".game-log"),a=document.querySelector(".game-container");t.classList.toggle("inactive"),e.classList.toggle("inactive"),a.classList.toggle("inactive")};(()=>{const e=t();document.querySelector("button.reset-board").addEventListener("click",e.resetBoard),document.querySelector("button.randomize").addEventListener("click",e.placeRandomly),document.querySelector("button.play-again").addEventListener("click",e.resetGame),document.addEventListener("click",(e=>{e.target.closest(".vs-CPU")?(()=>{const e=new r("Player"),a=new s("Computer");e.setEnemyBoard(a.getBoard()),a.setEnemyBoard(e.getBoard());const o=t();o.initVsComputer(e,a);const n=()=>e.turn?e:a,c=()=>{if(!o.checkShipsPlaced())return;document.querySelectorAll(".active .ship").forEach((t=>{const a=t.id,r=parseInt(t.dataset.length),s=o.getShipCoordinates(t,[parseInt(t.dataset.row),parseInt(t.dataset.col)]);e.addShip(a,r,s),t.remove()})),document.querySelector(".controller-container").classList.toggle("inactive");const t=document.querySelectorAll(".player-two .cell");e.turn=!0,t.forEach((t=>t.addEventListener("click",d))),o.placeComputerShips(),document.querySelectorAll(".active .ship").forEach((t=>{const e=t.id,r=parseInt(t.dataset.length),s=o.getShipCoordinates(t,[parseInt(t.dataset.row),parseInt(t.dataset.col)]);a.addShip(e,r,s),t.remove()})),document.querySelector(".active").classList.toggle("active"),o.displayGameLog(n()),o.displayBothBoards()},i=document.querySelector("button.start-game");i.addEventListener("click",c);const l=()=>{e.turn?(e.turn=!1,a.turn=!0):(e.turn=!0,a.turn=!1)},d=t=>{if(!e.turn)return;if(t.target.classList.contains("hit")||t.target.classList.contains("miss"))return;const r=[parseInt(t.target.dataset.row),parseInt(t.target.dataset.col)],s=e.playerAttack(r);s?(t.target.classList.add("hit"),e.checkGameOver()&&(e.turn=!1,o.displayWinner(e.name),e.reset(),a.reset(),i.removeEventListener("click",c))):s||t.target.classList.add("miss"),l(),o.displayGameLog(n()),setTimeout((()=>{(()=>{if(!a.turn)return;const t=a.computerAttacks(),[r,s]=a.getLastCoordinates(),d=document.querySelector(`.player-one.board .cell[data-row="${r}"][data-col="${s}"]`);t?(d.classList.add("hit"),a.checkGameOver()&&(a.turn=!1,o.displayWinner(a.name),e.reset(),a.reset(),i.removeEventListener("click",c))):t||d.classList.add("miss"),setTimeout((()=>{l(),o.displayGameLog(n())}),1e3)})()}),1e3)}})():e.target.closest(".vs-player")&&(()=>{const e=new r("Player 1"),a=new r("Player 2");e.setEnemyBoard(a.getBoard()),a.setEnemyBoard(e.getBoard());const s=t();s.initVsPlayer(e,a);const n=()=>e.turn?e:a;document.querySelector("button.next-player").addEventListener("click",(()=>{s.checkShipsPlaced()&&(document.querySelectorAll(".active .ship").forEach((t=>{const a=t.id,r=parseInt(t.dataset.length),o=s.getShipCoordinates(t,[parseInt(t.dataset.row),parseInt(t.dataset.col)]);e.addShip(a,r,o),t.remove()})),s.nextPlayerPlacement())}));const c=()=>{if(!s.checkShipsPlaced())return;document.querySelectorAll(".active .ship").forEach((t=>{const e=t.id,r=parseInt(t.dataset.length),o=s.getShipCoordinates(t,[parseInt(t.dataset.row),parseInt(t.dataset.col)]);a.addShip(e,r,o),t.remove()})),document.querySelector(".controller-container").classList.toggle("inactive");const t=document.querySelectorAll(".player-one .cell"),r=document.querySelectorAll(".player-two .cell");document.querySelectorAll(".ship-container").forEach((t=>t.classList.toggle("inactive"))),e.turn=!0,s.displayGameLog(n()),t.forEach((t=>t.addEventListener("click",u))),r.forEach((t=>t.addEventListener("click",d)))},i=document.querySelector("button.start-game");i.addEventListener("click",c);const l=t=>{const r=n();if(t.target.classList.contains("hit")||t.target.classList.contains("miss"))return;const l=[parseInt(t.target.dataset.row),parseInt(t.target.dataset.col)],d=r.playerAttack(l);if(d){if(t.target.classList.add("hit"),r.checkGameOver())return r.turn=!1,s.displayWinner(r.name),s.vsPlayerDisplayBothBoards(),e.reset(),a.reset(),void i.removeEventListener("click",c)}else d||t.target.classList.add("miss");e.turn?(e.turn=!1,a.turn=!0):(e.turn=!0,a.turn=!1),setTimeout((()=>{(()=>{const t=document.querySelector(".countdown");let e=5;const a=setInterval((()=>{e--,t.textContent=e,e<=0&&(clearInterval(a),t.textContent="Change!")}),1e3);t.textContent=5})(),o(),setTimeout((()=>{o(),s.displayGameLog(n()),s.changePlayer()}),6e3)}),1e3)},d=t=>{e.turn&&l(t)},u=t=>{a.turn&&l(t)}})()}))})()})();
//# sourceMappingURL=app.bundle.js.map